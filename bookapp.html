<!DOCTYPE html>
<header>
    <title></title>
</header>
<body>
    <form onsubmit="saveform(event)">
        <label>Name:</label>
        <input type="text" id="name" name="username" required/>
        <label>Email:</label>
        <input type="text" id="email" name="email" required/>
        <label>Phone:</label>
        <input type="tel" id="phone" name="phone" required/>
        <button>Submit</button>
    </form>
    <ul id='listOfUsers'></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"></script>
    <script>
        function saveform(event)
        {
            event.preventDefault();
            const name=event.target.username.value;
            const email=event.target.email.value;
            const phone=event.target.phone.value;
            if(localStorage.getItem(email) !==null)
            {
                alert('please enter unique email');
               
            }
            const obj ={
                name,
                email,
                phone
            }
            //const saveDetails = JSON.stringify(obj);
            axios.post("https://crudcrud.com/api/a28e19b473ca4f9b950b7364d6b1a9ce/appointData",obj)
            .then((res)=>{
                showFinal(res.data)
            })
            .catch((err)=>{
                document.body.innerHTML=document.body.innerHTML+'<h4>Somthing went wrong</h4>'
            })
            
        }
    
                
        

        function showFinal(user)
        {
            document.getElementById('email').value='';
            document.getElementById('name').value='';
            document.getElementById('phone').value='';
            
           

            const parentnode = document.getElementById('listOfUsers');
            const li = `<li id=${user._id}> ${user.name} - ${user.email}
                <button onclick=deleteUser('${user._id}')>Delete</button><button onclick=edit('${user.email}','${user.name}','${user.phone}')>Edit</button>
                </li>`
            parentnode.innerHTML=parentnode.innerHTML+li;
        }

        function edit(emailId,name,phone)
        {
            document.getElementById('email').value=emailId;
            document.getElementById('name').value=name;
            document.getElementById('phone').value=phone;
            //deleteUser(emailId)
            
        }
        function deleteUser(e)
        {
            axios
            .get("https://crudcrud.com/api/a28e19b473ca4f9b950b7364d6b1a9ce/appointData")
            .then((res)=>{
                for(let i=0; i<res.data.length; i++)
                {
                    
                    if(res.data[i]._id==e)
                    {
                        let str=res.data[i]._id;
                      
                        axios
                        .delete("https://crudcrud.com/api/a28e19b473ca4f9b950b7364d6b1a9ce/appointData"+'/'+str)
                        .then((res)=>{
                            document.body.innerHTML=document.body.innerHTML+'<h4>Deleted</h4>'
                            removeFromScreen(e);
                        })
                        .catch((err)=>{
                            document.body.innerHTML=document.body.innerHTML+'<h4>Somthing went wrong</h4>'
                        })
                    }
                }
            })
            .catch((err)=>{
                document.body.innerHTML=document.body.innerHTML+'<h4>Somthing went wrong</h4>'
            })
            // localStorage.removeItem(e);
            //removeFromScreen(e);
        }

        function removeFromScreen(e)
        {
            let parentnode = document.getElementById('listOfUsers');
            let userDelte = document.getElementById(e);
            
            if(userDelte)
            {
                parentnode.remove(userDelte);
            }
        }
        window.addEventListener("DOMContentLoaded", () => {

        axios
        .get("https://crudcrud.com/api/a28e19b473ca4f9b950b7364d6b1a9ce/appointData")
        .then((res)=>{
            for(let i=0; i<res.data.length; i++)
            {
                showFinal(res.data[i]);
            }
        })
        .catch((err)=>{
            document.body.innerHTML=document.body.innerHTML+'<h4>Somthing went wrong</h4>'
        })
        //     const details= Object.keys(localStorage)

        //    for(let i=0; i<details.length; i++)
        //    {
        //         const key=details[i];
        //         const userDetails = localStorage[key];
        //         const user = JSON.parse(userDetails);
        //         //showFinal(user);
        //    }
        }) 

    </script>
</body>
</html>